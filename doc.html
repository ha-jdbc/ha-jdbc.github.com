<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Oct 8, 2012
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20121008" />
    <meta http-equiv="Content-Language" content="en" />
    <title>HA-JDBC - </title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ha-jdbc/ha-jdbc">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="./" id="bannerLeft">
                                                                                                <img src="images/logo.png"  alt="HA-JDBC"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
            
                  <li id="publishDate">Last Published: 2012-10-08</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 2.1.0-SNAPSHOT</li>
                      
                
            
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
            
                <ul class="nav nav-list">
                    <li class="nav-header">About</li>
                                
      <li>
    
                          <a href="index.html" title="Overview">
          <i class="none"></i>
        Overview</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Documentation</a>
          </li>
                  
      <li>
    
                          <a href="schemas.html" title="XML Schema">
          <i class="none"></i>
        XML Schema</a>
            </li>
                  
      <li>
    
                          <a href="build.html" title="Building">
          <i class="none"></i>
        Building</a>
            </li>
                  
      <li>
    
                          <a href="http://github.com/ha-jdbc/ha-jdbc/downloads" class="externalLink" title="Downloads">
          <i class="none"></i>
        Downloads</a>
            </li>
                  
      <li>
    
                          <a href="http://sourceforge.net/projects/ha-jdbc/forums" class="externalLink" title="Forums">
          <i class="none"></i>
        Forums</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                        
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
            </ul>
                
            
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Documentation</h1><div class="section"><h2>Introduction<a name="Introduction"></a></h2><p>HA-JDBC is a JDBC proxy that enables a Java application to transparently access a cluster of identical databases through the JDBC API.</p><p><img src="images/ha-jdbc.png" alt="Database cluster access via HA-JDBC" /></p><p>HA-JDBC has the following advantages over normal JDBC:</p>
<dl><dt>High-Availability</dt><dd>The database cluster is available to service requests so long as at least one database node is active.</dd><dt>Fault Tolerance</dt><dd>Because HA-JDBC operates via the JDBC API, it is transaction-aware and can survive a database node failure without failing or corrupting current transactions.</dd><dt>Scalability</dt><dd>By balancing read requests across databases, HA-JDBC can meet increasing load by scaling horizontally (i.e. adding database nodes).</dd>
</dl></div><div class="section"><h2>Runtime requirements<a name="Runtime_requirements"></a></h2>
<ul>
  <li>Java 1.6+</li>
  <li>Type IV JDBC 4.x driver for underlying databases</li>
  <li>Configuration XML file per database cluster or bootstrapped programmatic configuration</li>
</ul></div><div class="section"><h2>Configuration<a name="Configuration"></a></h2><p>HA-JDBC is typically configured via XML file. The full schema definitions for past and present versions of HA-JDBC are enumerated <a href="schemas.html">here</a>.</p><div class="section"><h3>XML<a name="XML"></a></h3><p>The algorithm used to locate the configuration file resource at runtime is as follows:</p>
<ol style="list-style-type: decimal">
  <li>Determine the potentially parameterized resource name from one of the following sources:
  <ol style="list-style-type: decimal">
    <li>A <tt>config</tt> property passed to <tt>DriverManager.getConnection(String, Properties)</tt>, or the <tt>config</tt> property of the <tt>DataSource</tt>, <tt>ConnectionPoolDataSource</tt>, or <tt>XADataSource</tt>.</li>
    <li>The <tt>ha-jdbc.</tt><i>cluster-id</i><tt>.configuration</tt> system property.</li>
    <li>Use default value: <tt>ha-jdbc-{0}.xml</tt></li>
  </ol></li>
  <li>Format the parameterized resource name using the identifier of the cluster.</li>
  <li>Convert the formatted resource name to a URL. If the resource is not a URL, search for the resource in the classpath using the following class loaders:
  <ol style="list-style-type: decimal">
    <li>Thread context class loader</li>
    <li>The classloader used to load HA-JDBC</li>
    <li>System class loader</li>
  </ol></li>
</ol></div><div class="section"><h3>Defining databases<a name="Defining_databases"></a></h3><p>The general syntax for defining the databases composing an HA-JDBC cluster is as follows:</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster&gt;
       &lt;database id=&quot;...&quot; weight=&quot;#&quot;&gt;
         &lt;name&gt;...&lt;/name&gt;
         &lt;user&gt;...&lt;/user&gt;
         &lt;password&gt;...&lt;/password&gt;
         &lt;property name=&quot;...&quot;&gt;...&lt;/property&gt;
         &lt;!-- Additional properties --&gt;
       &lt;/database&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div>
<dl><dt>id</dt><dd>Uniquely identifies this database within the cluster.</dd><dt>weight</dt><dd>Defines the relative weight of this database node. See <a href="#balancer">Balancer</a> section for details.</dd><dt>name</dt><dd>In general, this describes the location of the database. For Driver-based clusters, this specifies the JDBC url of the database. For DataSource-based cluster, this specifies either:
  <ul>
    <li>The class name of the DataSource implementation (from which a new instance will be created).</li>
    <li>The JNDI name of the pre-bound DataSource.</li>
  </ul></dd><dt>user</dt><dd>The user name used by HA-JDBC to connect to the database for synchronization and meta-data caching purposes. This user should have administrative privileges. This differs from the database user used by your application (which likely has CRUD or read-only permissions).</dd><dt>password</dt><dd>The password for the above database user.</dd><dt>property</dt><dd><p>Defines a set of properties, the semantics of which depend on the cluster access pattern. For Driver-based clusters, these properties are passed to the corresponding call to <tt>Driver.connect(String, Properties)</tt> method. For DataSource-based clusters, if the database name specified a:</p>
  <ul>
    <li>class name, then these properties are interpreted as JavaBean properties used to initialize the DataSource instance. e.g.</li>
  </ul>
  <div class="source"><pre class="prettyprint linenums">    &lt;database id=&quot;db1&quot;&gt;
       &lt;name&gt;org.postgresql.ds.PGSimpleDataSource&lt;/name&gt;
       &lt;property name=&quot;serverName&quot;&gt;server1&lt;/property&gt;
       &lt;property name=&quot;portNumber&quot;&gt;5432&lt;/property&gt;
       &lt;property name=&quot;databaseName&quot;&gt;database&lt;/property&gt;
    &lt;/database&gt;
</pre></div>
  <ul>
    <li>JNDI name, then these properties are used as JNDI environment properties when constructing the initial context. e.g.</li>
  </ul>
  <div class="source"><pre class="prettyprint linenums">    &lt;database id=&quot;db1&quot;&gt;
       &lt;name&gt;java:comp/env/jdbc/db1&lt;/name&gt;
       &lt;property name=&quot;java.naming.provider.url&quot;&gt;...&lt;/property&gt;
    &lt;/database&gt;
</pre></div></dd>
</dl></div><div class="section"><h3>Dialect<a name="Dialect"></a></h3><p>The dialect attribute of a cluster determines the SQL syntax used by HA-JDBC for direct database operations. HA-JDBC includes dialects for the following databases: </p><table border="0" class="table table-striped">  <tr class="a">  <th>Dialect</th>  <th>Database vendor</th>  <th>Sequences</th>  <th>Identity columns</th>  <th>Dump/restore</th>  </tr>  <tr class="b">  <td><b>db2</b></td>  <td>IBM DB2</td>  <td>&#x2714;</td>  <td>&#x2714;</td>  <td></td>  </tr>  <tr class="a">  <td><b>derby</b></td>  <td>Apache Derby</td>  <td>&#x2714;</td>  <td>&#x2714;</td>  <td></td>  </tr>  <tr class="b">  <td><b>firebird</b></td>  <td>Firebird, InterBase</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="a">  <td><b>h2</b></td>  <td>H2 Database</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="b">  <td><b>hsqldb</b></td>  <td>HSQLDB</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="a">  <td><b>ingres</b></td>  <td>Ingres</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="b">  <td><b>maxdb</b></td>  <td>MySQL MaxDB, SAP DB</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="a">  <td><b>mckoi</b></td>  <td>Mckoi SQL Database</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="b">  <td><b>mysql</b></td>  <td>MySQL</td>  <td></td>  <td></td>  <td>&#x2714;</td>  </tr>  <tr class="a">  <td><b>oracle</b></td>  <td>Oracle Database</td>  <td>&#x2714;</td>  <td></td>  <td></td>  </tr>  <tr class="b">  <td><b>postgresql</b></td>  <td>PostgreSQL</td>  <td>&#x2714;</td>  <td>&#x2714;</td>  <td>&#x2714;</td>  </tr>  <tr class="a">  <td><b>sybase</b></td>  <td>Sybase</td>  <td></td>  <td>&#x2714;</td>  <td></td>  </tr>  <tr class="b">  <td><b>standard</b></td>  <td>SQL-92 compliant database</td>  <td></td>  <td></td>  <td></td>  </tr> </table><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster dialect=&quot;postgresql&quot;&gt;
       &lt;!-- ... --&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Balancer<a name="Balancer"></a></h3><p>When executing a read request from the cluster, HA-JDBC uses the configured balancer strategy to determine which database should service the request. Each database can define a weight to affect how it is prioritized by the balancer. If no weight is specified for a given database, it is assumed to be 1.</p><p>N.B. In general, a node with a weight of 0 will never service a request unless it is the last node in the cluster.</p><p>By default, HA-JDBC supports 4 types of balancers:</p>
<dl><dt>simple</dt><dd>Requests are always sent to the node with the highest weight.</dd><dt>random</dt><dd>Requests are sent to a random node. Node weights affect the probability that a given node will be chosen. The probability that a node will be chosen = <i>weight</i> / <i>total-weight</i>.</dd><dt>round-robin</dt><dd>Requests are sent to each node in succession. A node of weight <i>n</i> will receive <i>n</i> requests before the balancer moves on to the next node.</dd><dt>load</dt><dd>Requests are sent to the node with the smallest load. Node weights affect the calculated load of a given node. The load of a node = <i>concurrent-requests</i> / <i>weight</i>.</dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster balancer=&quot;simple&quot;&gt;
       &lt;!-- Read requests will always prefer db1 --&gt;
       &lt;database id=&quot;db1&quot; weight=&quot;2&quot;&gt;&lt;!-- ... --&gt;&lt;/database&gt;
       &lt;database id=&quot;db2&quot; weight=&quot;1&quot;&gt;&lt;!-- ... --&gt;&lt;/database&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Synchronization strategies<a name="Synchronization_strategies"></a></h3><p>Defines a strategy for synchronizing a database before activation. If the strategy contains JavaBean properties, you can override their default values.</p>
<dl><dt>passive</dt><dd>Does nothing. Use this strategy for read-only clusters, or if you know for a fact that the target database is already in sync.</dd><dt>dump-restore</dt><dd>Performs a native dump/restore from the source to the target database. Unlike other sync strategies, this strategy can synchronize both the schema and data.</dd><dt>full</dt><dd>Truncates each table in the target database and inserts data from the source database. <table border="0" class="table table-striped">  <tr class="a">  <th>Property</th>  <th>Default</th>  <th>Description</th>  </tr>  <tr class="b">  <td><b>fetchSize</b></td>  <td>0</td>  <td>Controls the maximum number of rows to fetch from the source database at a time.</td>  </tr>  <tr class="a">  <td><b>maxBatchSize</b></td>  <td>100</td>  <td>Controls the maximum number of insert/update/delete statements to execute within a batch.</td>  </tr> </table></dd><dt>diff</dt><dd>Performs a full table scan of source table vs target table, and performs necessary insert/update/delete. Supports the following properties: <table border="0" class="table table-striped">  <tr class="a">  <th>Property</th>  <th>Default</th>  <th>Description</th>  </tr>  <tr class="b">  <td><b>versionPattern</b></td>  <td></td>  <td>  Specifies a regular expression matching the column name of a last update timestamp (i.e. version) column.  If specified, a version comparison column can be used to determine whether a given row requires updating, instead of a full column scan.  </td>  </tr>  <tr class="a">  <td><b>fetchSize</b></td>  <td>0</td>  <td>Controls the maximum number of rows to fetch from the source database at a time.</td>  </tr>  <tr class="b">  <td><b>maxBatchSize</b></td>  <td>100</td>  <td>Controls the maximum number of insert/update/delete statements to execute within a batch.</td>  </tr> </table></dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;sync id=&quot;full&quot;&gt;
       &lt;property name=&quot;fetchSize&quot;&gt;1000&lt;/property&gt;
    &lt;/sync&gt;
    &lt;sync id=&quot;diff&quot;&gt;
       &lt;property name=&quot;fetchSize&quot;&gt;1000&lt;/property&gt;
       &lt;property name=&quot;versionPattern&quot;&gt;version&lt;/property&gt;
    &lt;/sync&gt;
    &lt;cluster default-sync=&quot;diff&quot;&gt;&lt;!-- ... --&gt;&lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Cluster state management<a name="Cluster_state_management"></a></h3>
<dl><dt>simple</dt><dd>A non-persistent state manager that stores cluster state in memory.</dd><dt>sql</dt><dd>A persistent state manager that uses an embedded database. This provider supports the following properties. <table border="0" class="table table-striped">  <tr class="a">  <th>Property</th>  <th>Default</th>  <th>Description</th>  </tr>  <tr class="b">  <td><b>urlPattern</b></td>  <td>  jdbc:h2:{1}/{0}<br />  jdbc:hsqldb:{1}/{0}<br />  jdbc:derby:{1}/{0};create=true  </td>  <td>  A MessageFormat pattern indicating the JDBC url of the embedded database.  The pattern can accept 2 parameters:  <ol style="list-style-type: decimal">  <li>The cluster identifier - typically used as the database name.</li>  <li>The home directory of the system user - typically used to indicate the location of the embedded database.</li>  </ol>  </td>  </tr>  <tr class="a">  <td><b>user</b></td>  <td></td>  <td>Authentication user name for the embedded database.</td>  </tr>  <tr class="b">  <td><b>password</b></td>  <td></td>  <td>Authentication password for the above user.</td>  </tr> </table> You can also override several properites to manipulate connection pooling behavior. The complete list and their default values are available in the <a class="externalLink" href="http://commons.apache.org/pool/apidocs/org/apache/commons/pool/impl/GenericObjectPool.html" title="Apache Commons Pool">Apache Commons Pool documentation</a>.</dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;state id=&quot;sql&quot;&gt;
       &lt;property name=&quot;urlPattern&quot;&gt;jdbc:hsqldb:{1}/{0}&lt;/property&gt;
    &lt;/state&gt;
    &lt;cluster&gt;&lt;!-- ... --&gt;&lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Durability<a name="Durability"></a></h3><p>As of version 2.1, HA-JDBC support a configurable durability level for user transactions. When enabled, HA-JDBC will track transactions, such that, upon restart, following a crash, it can detect and recover from any partial commits. The durability persistence mechanism is determined by the state manager configuration. By default, HA-JDBC includes support for the following durability levels:</p>
<dl><dt>none</dt><dd>No invocations are tracked. This durability level can neither detect nor recover from mid-commit crashes. This level offers the best performance, but offers no protection from crashes. Read-only database clusters should use this level.</dd><dt>coarse</dt><dd>Tracks cluster invocations only, but not per-database invocations. This durability level can detect, but not recover from, mid-commit crashes. Upon recovery, if any cluster invocations still exist in the log, all slave database will be deactivated and must be reactivated manually. This level offers a compromise between performance and resiliency.</dd><dt>fine</dt><dd>Tracks cluster invocations as well as per-database invokers. This durability level can both detect and recover from mid-commit crashes. Upon recovery, if any cluster invocations still exist in the log, all slave database will be deactivated and must be reactivated manually. While this level is the slowest, it ensures the highest level of resilency from crashes.</dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster durability=&quot;fine&quot;&gt;
       &lt;!-- ... --&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Distributed capabilities<a name="Distributed_capabilities"></a></h3><p>Indicates that database clusters defined in this file will be accessed by multiple JVMs. By default, HA-JDBC supports the following providers:</p>
<dl><dt>jgroups</dt><dd>Uses a JGroups channel to broadcast cluster membership changes to other peer nodes. The JGroups provider recognizes the following properties: <table border="0" class="table table-striped">  <tr class="a">  <th>Property</th>  <th>Default</th>  <th>Description</th>  </tr>  <tr class="b">  <td><b>stack</b></td>  <td>udp-sync.xml</td>  <td>  Defines one of the following:  <ul>  <li>Name of a system resource containing the JGroups XML configuration.</li>  <li>URL of the JGroups XML configuration file.</li>  <li>Path of the JGroups XML configuration on the local file system.</li>  <li>Legacy protocol stack property string.</li>  </ul>  See the <a class="externalLink" href="http://community.jboss.org/wiki/JGroups" title="JGroups">JGroups wiki</a> for assistance with customizing the protocol stack.  </td>  </tr>  <tr class="a">  <td><b>timeout</b></td>  <td>60000</td>  <td>Indicates the number of milliseconds allowed for JGroups operations.</td>  </tr> </table></dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;distributable id=&quot;jgroups&quot;&gt;
       &lt;property name=&quot;stack&quot;&gt;udp.xml&lt;/property&gt;
    &lt;/distributable&gt;
    &lt;cluster&gt;&lt;!-- ... --&gt;&lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Database meta-data caching<a name="Database_meta-data_caching"></a></h3><p>HA-JDBC makes extensive use of database meta data. For performance purposes, this information should be cached whenever possible. By default, HA-JDBC includes the following meta-data-cache options:</p>
<dl><dt>none</dt><dd>Meta data is loaded when requested and not cached.</dd><dt>lazy</dt><dd>Meta data is loaded and cached per database as it is requested.</dd><dt>shared-lazy</dt><dd>Meta data is loaded and cached as it is requested.</dd><dt>eager</dt><dd>All necessary meta data is loaded and cached per database during HA-JDBC initialization.</dd><dt>shared-eager</dt><dd>All necessary meta data is loaded and cached during HA-JDBC initialization.</dd>
</dl><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster meta-data-cache=&quot;shared-eager&quot;&gt;
       &lt;!-- ... --&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Password Obfuscation<a name="Password_Obfuscation"></a></h3><p>Since HA-JDBCs configuration file contains references to database passwords, some users may want to obfuscate these. To indicate that a password uses an obfuscation mechanism, use a : to indicate the appropriate decoder.</p><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster ...&gt;
       &lt;database id=&quot;db1&quot;&gt;
         &lt;name&gt;jdbc:h2:mem:db1&lt;/name&gt;
         &lt;user&gt;admin&lt;/user&gt;
         &lt;password&gt;?:wzAkF0hlYUeGhfzRQIxYAQ==&lt;/password&gt;
       &lt;/database&gt;
       &lt;database id=&quot;db2&quot;&gt;&lt;!-- ... --&gt;&lt;/database&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div><p>The following decoding mechanism are currently supported:</p>
<dl><dt>16</dt><dd>Decodes passwords using hexidecimal decoding.</dd><dt>64</dt><dd>Decodes passwords using Base64 decoding.</dd><dt>?</dt><dd><p>Decodes passwords using a symmetric encryption key from a keystore. The following system properties can be used to customize the properties of the key and/or keystore: </p><table border="0" class="table table-striped">  <tr class="a">  <th>System property</th>  <th>Default value</th>  </tr>  <tr class="b">  <td>ha-jdbc.keystore.file</td>  <td>$HOME/.keystore</td>  </tr>  <tr class="a">  <td>ha-jdbc.keystore.type</td>  <td>jceks</td>  </tr>  <tr class="b">  <td>ha-jdbc.keystore.password</td>  <td><i>none</i></td>  </tr>  <tr class="a">  <td>ha-jdbc.key.alias</td>  <td>ha-jdbc</td>  </tr>  <tr class="b">  <td>ha-jdbc.key.password</td>  <td><i>required</i></td>  </tr> </table> Use the following command to generate encrypted passwords for use in your config file:
  <div class="source"><pre class="prettyprint linenums">java -classpath ha-jdbc.jar net.sf.hajdbc.codec.crypto.CipherCodecFactory [password]
</pre></div></dd>
</dl></div><div class="section"><h3>Customizing HA-JDBC<a name="Customizing_HA-JDBC"></a></h3><p>HA-JDBC supports a number of extension points. Most components support custom implementations, including:</p>
<ul>
  <li><a href="apidocs/net/sf/hajdbc/balancer/BalancerFactory.html">net.sf.hajdbc.balancer.BalancerFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/cache/DatabaseMetaDataCacheFactory.html">net.sf.hajdbc.cache.DatabaseMetaDataCacheFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/codec/CodecFactory.html">net.sf.hajdbc.codec.CodecFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/dialect/DialectFactory.html">net.sf.hajdbc.dialect.DialectFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/distributed/CommandDispatcherFactory.html">net.sf.hajdbc.distributed.CommandDispatcherFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/durability/DurabilityFactory.html">net.sf.hajdbc.durability.DurabilityFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/lock/LockManagerFactory.html">net.sf.hajdbc.lock.LockManagerFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/state/StateManagerFactory.html">net.sf.hajdbc.state.StateManagerFactory</a></li>
  <li><a href="apidocs/net/sf/hajdbc/SynchronizationStrategy.html">net.sf.hajdbc.SynchronizationStrategy</a></li>
</ul><p>In general, to configure HA-JDBC with a custom component:</p>
<ol style="list-style-type: decimal">
  <li>Create an implementation of the custom component. All extension points implement a getId() method which indicates the identifier by which this instance will be referenced in the configuration file.</li>
  <li>Create a <tt>META-INF/services/interface-name</tt> file containing the fully qualified class name of the custom implementation.</li>
  <li>Reference your custom component by identifier in your ha-jdbc xml file.</li>
</ol><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">package org.myorg;

public class CustomDialectFactory implements net.sf.hajdbc.dialect.DialectFactory {
    @Override
    public String getId() {
       return &quot;custom&quot;;
    }

    @Override
    public net.sf.hajdbc.dialect.Dialect createDialect() {
       return new StandardDialect() {
         // Override methods to customize behavior
       };
    }
}
</pre></div><p><tt>META-INF/services/net.sf.hajdbc.dialect.DialectFactory</tt></p>
<div class="source"><pre class="prettyprint linenums">org.myorg.CustomDialectFactory
</pre></div><p><tt>ha-jdbc.xml</tt></p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster dialect=&quot;custom&quot; ...&gt;
       &lt;!-- ... --&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div></div><div class="section"><h3>Programmatic configuration<a name="Programmatic_configuration"></a></h3><p>As of version 2.1, an HA-JDBC cluster can be configured programmatically.</p><p>e.g.</p>
<div class="source"><pre class="prettyprint linenums">// Define each database in the cluster
DriverDatabase db1 = new DriverDatabase();
db1.setId(&quot;db1&quot;);
db1.setName(&quot;jdbc:hsqldb:mem:db1&quot;);
db1.setUser(&quot;sa&quot;);
db1.setPassword(&quot;&quot;);

DriverDatabase db2 = new DriverDatabase();
db2.setId(&quot;db2&quot;);
db2.setName(&quot;jdbc:hsqldb:mem:db2&quot;);
db2.setUser(&quot;sa&quot;);
db2.setPassword(&quot;&quot;);

// Define the cluster configuration itself
DriverDatabaseClusterConfiguration config = new DriverDatabaseClusterConfiguration();
// Specify the database composing this cluster
config.setDatabases(Arrays.asList(db1, db2));
// Define the dialect
config.setDialectFactory(new HSQLDBDialectFactory());
// Don't cache any meta data
config.setDatabaseMetaDataCacheFactory(new SimpleDatabaseMetaDataCacheFactory());
// Use an in-memory state manager
config.setStateManagerFactory(new SimpleStateManagerFactory());
// Make the cluster distributable
config.setDispatcherFactory(new JGroupsCommandDispatcherFactory());

// Register the configuration with the HA-JDBC driver
for (java.sql.Driver driver: DriverManager.getDrivers()) {
    if (driver instanceof Driver) {
       ((Driver) driver).getConfigurationFactories().put(&quot;mycluster&quot;, new SimpleDatabaseClusterConfigurationFactory&lt;Driver, DriverDatabase&gt;(config));
       break;
    }
}

// Database cluster is now ready to be used!
Connection connection = DriverManager.getConnection(&quot;jdbc:ha-jdbc:mycluster&quot;, &quot;sa&quot;, &quot;&quot;);
</pre></div></div></div><div class="section"><h2>Using HA-JDBC<a name="Using_HA-JDBC"></a></h2><p>Application access an HA-JDBC cluster either via the Driver or DataSource.</p><div class="section"><h3>Driver-based access<a name="Driver-based_access"></a></h3><p>To access a specific cluster via the Driver, HA-JDBC must be configured to access your databases accordingly.</p><p>e.g.</p><p><tt>ha-jdbc-mycluster.xml</tt></p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster&gt;
       &lt;database id=&quot;db1&quot;&gt;
         &lt;name&gt;jdbc:postgresql://server1/database&lt;/name&gt;
         &lt;user&gt;pgadmin&lt;/user&gt;
         &lt;password&gt;password&lt;/password&gt;
       &lt;/database&gt;
       &lt;database id=&quot;db2&quot;&gt;
         &lt;name&gt;jdbc:postgresql://server2/database&lt;/name&gt;
         &lt;user&gt;pgadmin&lt;/user&gt;
         &lt;password&gt;password&lt;/password&gt;
       &lt;/database&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div><p>HA-JDBC connection can then be established via:</p>
<div class="source"><pre class="prettyprint linenums">java.sql.Connection connection = java.sql.DriverManager.getConnection(&quot;jdbc:ha-jdbc:mycluster&quot;, &quot;user&quot;, &quot;password&quot;);
</pre></div></div><div class="section"><h3>DataSource-based access<a name="DataSource-based_access"></a></h3><p>To access a specific cluster via a DataSource, HA-JDBC must be configured to access your databases via DataSources. HA-JDBC provides a DataSource, ConnectionPoolDataSource, and XADataSource implementations, depending on which resource you plan to proxy.</p><p>e.g.</p><p><tt>ha-jdbc-mycluster.xml</tt></p>
<div class="source"><pre class="prettyprint linenums">&lt;ha-jdbc xmlns=&quot;urn:sourceforge:ha-jdbc:2.1&quot;&gt;
    &lt;cluster&gt;
       &lt;database id=&quot;db1&quot;&gt;
         &lt;name&gt;org.postgresql.ds.PGSimpleDataSource&lt;/name&gt;
         &lt;user&gt;pgadmin&lt;/user&gt;
         &lt;password&gt;password&lt;/password&gt;
         &lt;property name=&quot;serverName&quot;&gt;server1&lt;/property&gt;
         &lt;property name=&quot;portNumber&quot;&gt;5432&lt;/property&gt;
         &lt;property name=&quot;databaseName&quot;&gt;database&lt;/property&gt;
       &lt;/database&gt;
       &lt;database id=&quot;db2&quot;&gt;
         &lt;name&gt;org.postgresql.ds.PGSimpleDataSource&lt;/name&gt;
         &lt;user&gt;pgadmin&lt;/user&gt;
         &lt;password&gt;password&lt;/password&gt;
         &lt;property name=&quot;serverName&quot;&gt;server2&lt;/property&gt;
         &lt;property name=&quot;portNumber&quot;&gt;5432&lt;/property&gt;
         &lt;property name=&quot;databaseName&quot;&gt;database&lt;/property&gt;
       &lt;/database&gt;
    &lt;/cluster&gt;
&lt;/ha-jdbc&gt;
</pre></div><p>To deploy the HA-JDBC DataSource in Tomcat:</p><p><tt>context.xml</tt></p>
<div class="source"><pre class="prettyprint linenums">&lt;Context&gt;
    &lt;!-- ... --&gt;
    &lt;Resource name=&quot;jdbc/mycluster&quot; type=&quot;javax.sql.DataSource&quot;
              factory=&quot;net.sf.hajdbc.sql.DataSourceFactory&quot;
              cluster=&quot;mycluster&quot; config=&quot;file:///path/to/ha-jdbc-mycluster.xml&quot;/&gt;
    &lt;!-- ... --&gt;
&lt;/Context&gt;
</pre></div><p>To make the DataSource referenceable from your application:</p><p><tt>web.xml</tt></p>
<div class="source"><pre class="prettyprint linenums">&lt;web-app&gt;
    &lt;!-- ... --&gt;
    &lt;resource-env-ref&gt;
       &lt;resource-env-ref-name&gt;jdbc/mycluster&lt;/resource-env-ref-name&gt;
       &lt;resource-env-ref-type&gt;javax.sql.DataSource&lt;/resource-env-ref-type&gt;
    &lt;/resource-env-ref&gt;
    &lt;!-- ... --&gt;
&lt;/web-app&gt;
</pre></div><p>You can then access the cluster via:</p>
<div class="source"><pre class="prettyprint linenums">javax.context.Context context = new javax.context.InitialContext();
javax.sql.DataSource ds = (javax.sql.DataSource) context.lookup(&quot;java:comp/env/jdbc/mycluster&quot;);
java.sql.Connection connection = ds.getConnection(&quot;user&quot;, &quot;password&quot;);
</pre></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                    2004-2012
                        <a href="https://github.com/pferraro">Paul Ferraro</a>.
            All Rights Reserved.      
            
      </div>

        
        
                </div>
    </footer>
  </body>
</html>
